<p>#【工作周报】 趣企技术中心-平台开发-夏见明-2017.11.20</p>
<h2>本周工作进展</h2>
<table>
<thead>
<tr>
<th>项目名称</th>
<th>计划完成时间</th>
<th>实际完成时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>Nginx log分片</td>
<td>周二</td>
<td>周二</td>
</tr>
<tr>
<td>Auth启动优化</td>
<td>周二</td>
<td>周二</td>
</tr>
<tr>
<td>团队版不加密</td>
<td>周三</td>
<td>周三</td>
</tr>
<tr>
<td>Nginx log 清除n天之前log</td>
<td>周四</td>
<td>周四</td>
</tr>
<tr>
<td>删除任务（任务或子任务有其它成员）的提示</td>
<td>周四</td>
<td>周四</td>
</tr>
<tr>
<td>曲奇办公&amp;云盘 分项目，根据quqi_id进入指定路由</td>
<td>周五</td>
<td>根据优先级周五切换到其它任务（周四确定了以后的云盘及办公公共功能的更新方式，简易的demo确认了可行性）</td>
</tr>
<tr>
<td>跨团队目录复制&amp;批量复制</td>
<td>下周一</td>
<td>进度正常</td>
</tr>
</tbody>
</table>
<h2>碰到的技术问题以及解决方案</h2>
<table>
<thead>
<tr>
<th>问题/建议</th>
<th>解决方案</th>
</tr>
</thead>
<tbody>
<tr>
<td>Nginx log分片 &amp; 清除n天之前log</td>
<td>脚本可传入四个参数：<br>①：nginx路径；<br>②：存储log日志的目录<br>③：pid文件名称，默认是nginx.pid；<br>④：清除n天前的日志，默认是14，使用-mtime +n，实际清除的是15天前的log<br>分片步骤：<br>①：确认存储log日志的目录会被创建；<br>②：清除日志；<br>③：迁移日志；<br>④：重新生成日志</td>
</tr>
<tr>
<td>Auth启动优化</td>
<td>上周先在AuthServer加了详细log，周一在重启后分析了Auth启动主要花费的时间：<br>①：Passport加载——28s；<br>②：Company加载——7s ；<br>③：ding user加载——7s<br>仔细看了下AuthServer的代码，Passport及Company加载速度较慢的原因是在每次加载code时需要进行一次sql查询，目前两者的速度分别在5w及4k左右，时间主要花费在sql查询上；Ding user加载速度则主要在取出DingUser对应的DingCompany时，使用了ForEach，这部分花费的太多时间。优化之后，AuthServer启动时间5s。</td>
</tr>
</tbody>
</table>
<h2>现阶段工作</h2>
<table>
<thead>
<tr>
<th>工作描述</th>
<th>重要等级</th>
<th>紧急等级</th>
</tr>
</thead>
<tbody>
<tr>
<td>跨团队目录复制 &amp; 批量复制</td>
<td>重要</td>
<td>紧急</td>
</tr>
</tbody>
</table>
